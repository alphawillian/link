(function(t){function e(e){for(var o,r,a=e[0],c=e[1],u=e[2],p=0,d=[];p<a.length;p++)r=a[p],i[r]&&d.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);l&&l(e);while(d.length)d.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(o=!1)}o&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var o={},i={5:0},s=[];function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/activity/2018/location/html/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var l=c;s.push([7,1]),n()})({"+n12":function(t,e,n){"use strict";n.d(e,"b",function(){return o}),n.d(e,"a",function(){return i});n("NO8f"),n("SRfc"),n("f3/d"),n("Oyvg"),n("KKXr"),n("pIFo"),n("xfY5"),n("yt8O"),n("VRzm");function o(t){var e=RegExp("[?&]"+t+"=([^&|#?]*)").exec(window.location.href);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}function i(){var t=5e3,e=!1;return new Promise(function(n,o){var i=new window.BMap.Geolocation;i.getCurrentPosition(function(t){console.log("this.getStatus():",this.getStatus()),0===this.getStatus()?(e=!0,clearTimeout(s),n({lat:t.point.lat,lng:t.point.lng}),console.log("百度定位的经纬度:",t.point)):(e=!0,clearTimeout(s),n(null),console.log("百度地图未获取到定位"))},{enableHighAccuracy:!0});var s=window.setTimeout(function(){e||(e=!0,n(null))},t)})}},7:function(t,e,n){t.exports=n("Wwoe")},BTUV:function(t,e,n){},CXrA:function(t,e,n){"use strict";var o=n("nqhI"),i=n.n(o);i.a},Is5O:function(t,e,n){"use strict";n("8ujH"),n("Qyje");var o=n("yT7P"),i=(n("yt8O"),n("VRzm"),n("vDqi")),s=n.n(i);function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"get";i=i.toLowerCase();var r={data:n},a=Object(o["a"])({url:e},r,{method:i});return new Promise(function(e,n){var o=s.a.create({baseURL:t,timeout:3e4,withCredentials:!0,crossDomain:!0,headers:{"Content-Type":"application/json;charset=UTF-8","X-Requested-With":"XMLHttpRequest"}});o(a).then(function(t){var n=t.data,o=!0;if(n&&"1"===n.resultCode&&"010000"===n.resultStatus&&(o=!1),!o){var i=window.location.href,s="//plogin.m.jd.com/user/login.action?appid=100&returnurl=";return window.location.href=s+encodeURIComponent(i),!1}return e(n)}).catch(function(t){if(t.response){var e=t.status,o=t.message,i={code:e,respMsg:o};return n(i)}var s={type:"canceled",respMsg:"数据请求超时"};return n(s)})})}var a="https://lbspayapi.jd.com",c="/omms/md.htm",u="/omdj/ml.htm",l="/omm/ml.htm",p="/om/cities.htm",d="/omm/tp.htm",f="/om/describe.htm",m="/om/placeSearch.htm",h="/omm/md.htm";n.d(e,"a",function(){return g}),n.d(e,"e",function(){return v}),n.d(e,"f",function(){return b}),n.d(e,"d",function(){return w}),n.d(e,"b",function(){return y}),n.d(e,"c",function(){return C}),n.d(e,"g",function(){return I}),n.d(e,"h",function(){return j});var g=function(t){return r(a,c,t,"post")},v=function(t){return r(a,u,t,"post")},b=function(t){return r(a,l,t,"post")},w=function(t){return r(a,p,t,"post")},y=function(t){return r(a,d,t,"post")},C=function(t){return r(a,f,t,"post")},I=function(t){return r(a,m,t,"post")},j=function(t){return r(a,h,t,"post")}},J19P:function(t,e,n){},Wwoe:function(t,e,n){"use strict";n.r(e);n("yt8O"),n("VRzm");var o=n("Kw5r"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[t.isFullLoading?n("div",{staticClass:"fullLoading"},[n("Loading",{attrs:{type:"spinner"}})],1):t._e(),n("div",{attrs:{id:"map"}}),n("div",{attrs:{id:"shop-content"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:0===t.infoStatus,expression:"infoStatus === 0"}],staticClass:"slide-bar",on:{click:t.changeInfoStatus}},[n("i")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showStoreInfo,expression:"showStoreInfo"}],attrs:{id:"content-body"}},[n("div",{staticClass:"shop-main"},[n("span",{staticClass:"shop-logo"},[n("span",{staticClass:"shop-logo-inner"},[n("img",{attrs:{src:t.storeInfo.logoAddress,alt:""}})])]),n("span",{staticClass:"shop-info"},[n("div",{staticClass:"shop-line1"},[n("div",{staticClass:"shop-name"},[t._v(t._s(t.storeInfo.realName))]),n("span",{staticClass:"shop-distance range"},[t._v(t._s(t.storeInfo.distance)+t._s(t.storeInfo.distanceUnit))])]),n("div",{staticClass:"shop-line2"},[n("span",{staticClass:"shop-pay"},[n("span",{staticClass:"spt-key"},[t._v("支持")]),t._l(t.storeInfo.payWays,function(e,o){return n("span",{key:o,staticClass:"spt-item"},[t._v(t._s(t.payWayMaps[e]))])})],2)]),n("div",{staticClass:"shop-line3"},[n("span",{staticClass:"shop-address"},[t._v(t._s(t.storeInfo.address))]),n("span",{staticClass:"shop-nav",on:{click:t.goNav}},[n("img",{attrs:{src:"//img30.360buyimg.com/jr_image/jfs/t1/11804/37/13949/552/5c9c55b3Ea6310eb1/8f85469dc102ea9d.png"}}),t._v("到这去\n            ")])])])]),n("transition",{attrs:{name:"fade"}},[1===t.infoStatus?n("div",[n("div",{staticClass:"shop-fn"},[n("div",{staticClass:"coupon-block"},[t.storeInfo.preferenceActivities&&t.storeInfo.preferenceActivities.length?n("ul",{staticClass:"coupon-packet"},t._l(t.storeInfo.preferenceActivities,function(e,o){return n("coupon-item",{key:o,attrs:{info:e,storeCode:t.storeInfo.storeCode,latLng:t.userInfo,type:"coupon"},on:{sendPoint:t.sendPoint}})})):n("div",{staticClass:"coupon-none"},[n("img",{attrs:{src:"//img30.360buyimg.com/jr_image/jfs/t1/29851/2/12914/7602/5c9c55b2E9d8e908c/d2adddccca7adcde.png"}}),n("div",{staticClass:"coupon-none-desc"},[t._v("该门店暂时没有优惠活动哦~")])])])])]):t._e()])],1)])])},s=[],r=(n("ls82"),n("MECJ")),a=n("+n12"),c=n("uXAG"),u=n("p3Gn"),l=n("Is5O"),p={name:"",components:{CouponItem:u["a"],Loading:c["a"]},data:function(){return{isFullLoading:!1,map:null,storeCode:"",userInfo:{lat:"39.7294520",lng:"116.3418830"},storeInfo:{lat:"39.9040600",lng:"116.3833400"},showStoreInfo:!1,infoStatus:1,payWayMaps:{0:"京东支付",1:"京东码支付",2:"京东闪付"},cityName:"北京",typeMap:{1001:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t18571/188/2602886191/2783/ece3d467/5b03caf0N5d78d5ba.png"},1002:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t19840/322/610641234/2778/78210e8b/5b03caf1N4131e16f.png"},1003:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t17764/110/2688585904/2811/d88b153c/5b03caf0N8dc6dd61.png"},1004:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t17647/216/2662133761/3128/a2b151bf/5b03caf0N4bcd55e6.png"},1005:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t19447/222/2704889261/2914/ec98cb87/5b04fcb3N2f9c81a6.png"},1006:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t17647/214/2672585472/3043/a8947b8a/5b03caf0N24e0f723.png"},1007:{w:37,h:52,img:"//img30.360buyimg.com/jr_image/jfs/t20128/111/223465037/2799/feab938e/5b03caf0N0a1d4815.png"},1008:{w:58,h:58,img:"//img30.360buyimg.com/jr_image/jfs/t22354/152/214417068/3996/9b41e2e7/5b041adcNc758c755.png"}}}},watch:{storeInfo:function(t,e){console.log("nVal",t)}},created:function(){},mounted:function(){this.pageInit(),this.sendPoint("page")},methods:{pageInit:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(Object(a["b"])("storeCode")&&(this.storeCode=Object(a["b"])("storeCode")),!Object(a["b"])("lat")||!Object(a["b"])("lng")){t.next=8;break}this.userInfo.lat=Object(a["b"])("lat"),this.userInfo.lng=Object(a["b"])("lng"),this.mapInit(),this.doQueryStoreDetail(),t.next=22;break;case 8:return e=null,t.prev=9,this.isFullLoading=!0,t.next=13,Object(a["a"])();case 13:e=t.sent,t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](9);case 18:e&&e.lat&&e.lng?(this.userInfo.lat=e.lat,this.userInfo.lng=e.lng):Object(c["b"])("未获取到您的位置，请在‘设置’中开启定位功能"),console.log("res:",e),this.mapInit(),this.doQueryStoreDetail();case 22:this.setShareOption();case 23:case"end":return t.stop()}},t,this,[[9,16]])}));return function(){return t.apply(this,arguments)}}(),doQueryStoreDetail:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={storeCode:this.storeCode,latitude:this.userInfo.lat,longitude:this.userInfo.lng},n=null,t.prev=2,this.isFullLoading=!0,t.next=6,Object(l["h"])(e);case 6:n=t.sent,this.isFullLoading=!1,t.next=15;break;case 10:t.prev=10,t.t0=t["catch"](2),this.isFullLoading=!1,console.log("err",t.t0),Object(c["b"])(t.t0);case 15:"0"===n.resultCode?(this.storeInfo=n.resultData,this.showStoreInfo=!0,this.initStoreIcon()):Object(c["b"])(n.resultMsg||"服务异常 请稍后再试！"),console.log("storeDetail:",n);case 17:case"end":return t.stop()}},t,this,[[2,10]])}));return function(){return t.apply(this,arguments)}}(),doQueryAddressName:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,n,o,i,s=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.storeInfo,n={latitude:e.latitude,longitude:e.longitude},o={},t.prev=3,t.next=6,Object(l["c"])(n);case 6:o=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),setTimeout(function(){s.doQueryAddressName()},3e3);case 12:"0"===o.resultCode?(i=o.resultData,this.cityName=i.addressComponent.city):setTimeout(function(){s.doQueryAddressName()},3e3);case 13:case"end":return t.stop()}},t,this,[[3,9]])}));return function(){return t.apply(this,arguments)}}(),mapInit:function(){this.map=new window.BMap.Map("map",{minZoom:11,maxZoom:18});var t=new window.BMap.Point(this.userInfo.lng,this.userInfo.lat);this.map.centerAndZoom(t,12),this.map.enableScrollWheelZoom(!0),this.mapEventInit()},mapEventInit:function(){var t=this;this.map.addEventListener("dragstart",function(){console.log("dragstart"),t.infoStatus=0})},initStoreIcon:function(){var t=this,e=window.innerHeight,n=new window.BMap.Point(this.storeInfo.longitude,this.storeInfo.latitude);this.map.setCenter(n),this.map.panBy(0,-e/4);var o=this.typeMap[this.storeInfo.industryCategory||"1001"],i=o.img,s={position:n,offset:new window.BMap.Size("50%",o.h/1)},r=new window.BMap.Icon(i,new window.BMap.Size(o.w,o.h),{imageSize:new window.BMap.Size(o.w,o.h)}),a=new window.BMap.Marker(n,{icon:r});this.map.addOverlay(a);var c=new window.BMap.Label(this.storeInfo.realName,s);c.setStyle({backgroundColor:"rgba(0,0,0,0.6)",color:"white",fontSize:"0.24rem",height:"0.4rem",lineHeight:"0.44rem",borderRadius:"0.2rem",border:"none",transform:"translateX(-50%)",left:o.w/2+"px",padding:"0 0.2rem"}),a.setLabel(c),a.addEventListener("click",function(){t.infoStatus=1}),c.addEventListener("click",function(){t.infoStatus=1})},goNav:function(){var t=[];t.push("origin="+this.userInfo.lat+","+this.userInfo.lng),t.push("destination=latlng:"+this.storeInfo.latitude+","+this.storeInfo.longitude+"|name:"+this.storeInfo.realName),t.push("region="+this.cityName),t.push("mode=walking&output=html&coord_type=bd09ll&src=webapp.baidu.openAPIdemo");var e=t.join("&"),n="https://api.map.baidu.com/direction?"+e;console.log("url:",n),console.log(e),this.sendPoint("goNav",n)},changeInfoStatus:function(){this.infoStatus=1},setShareOption:function(){var t={moreItem:!0,share_title:"身边优惠",share_subtitle:"立刻戳我，发现更多身边优惠！",share_url:"https://pb.jd.com/activity/2018/location/html/map.html?storeCode="+this.storeCode,share_img:"https://img30.360buyimg.com/jr_image/jfs/t16885/160/96786978/4628/8a691c3/5a5c760aN03e549ec.jpg",channels:["1","2","3","4","5"]};window.JPFESDK.setShare(t)},sendPoint:function(t,e){window.JPTrack.emit(["map",t],e)}}},d=p,f=(n("CXrA"),n("KHd+")),m=Object(f["a"])(d,i,s,!1,null,"13dc0222",null),h=m.exports;n("FXp9"),n("J19P");o["a"].config.productionTip=!1,o["a"].config.errorHandler=function(t,e,n){if(t){var o=t.message,i=t.stack;window.__sgm__.error({msg:n+o,stack:i})}},o["a"].use(c["c"]),new o["a"]({render:function(t){return t(h)}}).$mount("jdjr-div")},XPPn:function(t,e,n){"use strict";var o=n("BTUV"),i=n.n(o);i.a},nqhI:function(t,e,n){},p3Gn:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{class:["item","coupon"]},["1"===t.info.mktActType||"2"===t.info.mktActType?n("span",{staticClass:"left"},[n("span",{staticClass:"coupon-sign"},[t._v("￥")]),n("span",{staticClass:"coupon-amount"},[t._v(t._s(t.info.prizeAmount))])]):n("div",{staticClass:"left lottery"}),n("span",{staticClass:"middle"},["1"===t.info.mktActType||"2"===t.info.mktActType?n("div",{staticClass:"coupon-name"},[t._v(t._s(t.info.prizeName))]):n("div",{staticClass:"coupon-name"},[t._v("红包")]),n("div",{staticClass:"coupon-limit"},[t._v(t._s(t.info.prizeDesc))])]),n("span",{staticClass:"right"},[1===t.info.operation?n("button",{on:{click:function(e){t.dogetCouponLottery(t.info.entranceId)}}},[t._v("领取")]):n("button",{on:{click:function(e){t.lookCoupon(t.info.useUrl)}}},[t._v("查看")]),n("div",{staticClass:"coupon-percent"},[t._v("剩余"+t._s(t.percent)+"%")])])])},i=[],s=(n("ls82"),n("MECJ")),r=n("uXAG"),a=n("Is5O"),c={name:"",props:{info:{type:Object,default:function(){return{}}},type:{type:String,default:""},storeCode:{type:String,default:""},latLng:{type:Object,default:function(){return{}}}},components:{},data:function(){return{}},computed:{percent:function(){var t=this.info.payCountLimit+this.info.payCount,e=this.info.payCountLimit,n=100*e/t;return n>100?n=100:n>99&&n<100?n=99:n>0&&n<1&&(n=1),n.toFixed(0)}},created:function(){},mounted:function(){},methods:{dogetCouponLottery:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){var n,o,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=this.latLng,o={storeCode:this.storeCode,latitude:n.lat,longitude:n.lng,entranceId:e,site:"1",fromS:""},console.log("getCoupon reqParams",o),i={},t.prev=4,r["b"].loading({duration:0,forbidClick:!0,loadingType:"spinner"}),t.next=8,Object(a["b"])(o);case 8:i=t.sent,console.log(i),r["b"].clear(),t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](4),r["b"].clear(),Object(r["b"])(i.data||"领奖异常请稍后再试！");case 17:"0"===i.resultCode?(this.info.operation=2,this.info.payCount++,"3"===this.info.mktActType&&(this.info.mktActType="2",this.info.prizeAmount=i.resultData.prizeAmount,this.info.prizeName=i.resultData.prizeName,this.info.prizeDesc=i.resultData.prizeDesc),this.$emit("sendPoint","getLotterySucc")):(this.$emit("sendPoint","getLotteryError"),Object(r["b"])(i.resultMsg)),this.$emit("sendPoint","getLottery");case 19:case"end":return t.stop()}},t,this,[[4,13]])}));return function(e){return t.apply(this,arguments)}}(),getLatLng:function(){var t=sessionStorage.getItem("confirmedAddressInfo"),e=JSON.parse(t);this.latLng.lat=e.addressInfo.lat,this.latLng.lng=e.addressInfo.lng},lookCoupon:function(t){location.href=t}}},u=c,l=(n("XPPn"),n("KHd+")),p=Object(l["a"])(u,o,i,!1,null,"1caaf4e4",null);e["a"]=p.exports}});
//# sourceMappingURL=page3.f0bf73b3.js.map